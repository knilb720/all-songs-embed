<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patrick Boylan's Song List</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
            padding: 40px 20px 20px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            color: #ffffff;
        }

        /* Filter buttons container */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 20px 0;
        }

        /* Filter button styling - dark mode */
        .filter-btn {
            background-color: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-btn.active {
            background-color: #ffffff;
            color: #000000;
        }

        /* Search container */
        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            padding: 0 10px;
        }

        .search-input {
            width: 100%;
            max-width: 500px;
            padding: 12px 20px;
            font-size: 16px;
            background-color: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
            border-radius: 8px;
            font-family: inherit;
        }

        .search-input::placeholder {
            color: #888888;
        }

        /* Error message */
        .error-message {
            display: none;
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #1a1a1a;
            border: 2px solid #ffffff;
            border-radius: 8px;
        }

        .error-message.show {
            display: block;
        }

        .error-message p {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .notify-btn {
            background-color: #ffffff;
            color: #000000;
            border: 2px solid #ffffff;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Song table wrapper */
        .songlist-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
            overflow-x: auto;
        }

        /* Song table styling - dark mode */
        .songlist-table {
            border-collapse: collapse;
            width: 100%;
            max-width: 900px;
        }

        .songlist-table th,
        .songlist-table td {
            text-align: left;
            padding: 12px 15px;
            font-size: 16px;
            color: #ffffff;
        }

        .songlist-table th {
            font-weight: bold;
            border-bottom: 2px solid #333333;
            background-color: #111111;
        }

        .songlist-table tr:not(:first-child) td {
            border-bottom: 1px solid #222222;
        }

        /* Column widths */
        .songlist-table th:nth-child(1),
        .songlist-table td:nth-child(1) {
            width: 40%;
        }

        .songlist-table th:nth-child(2),
        .songlist-table td:nth-child(2) {
            width: 40%;
        }

        .songlist-table th:nth-child(3),
        .songlist-table td:nth-child(3) {
            width: 20%;
            text-align: right;
        }

        /* Request button styling - dark mode */
        .request-btn {
            background-color: #000000;
            color: #ffffff;
            border: 2px solid #ffffff;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            white-space: nowrap;
        }

        /* Highlight search results */
        .highlight {
            background-color: #333333;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 40px 15px 20px 15px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

            .filter-buttons {
                gap: 10px;
                padding: 15px 0;
                margin-bottom: 15px;
            }

            .filter-btn {
                padding: 10px 16px;
                font-size: 12px;
            }

            .search-input {
                max-width: 100%;
                font-size: 16px;
            }

            .error-message p {
                font-size: 14px;
            }

            .songlist-table th,
            .songlist-table td {
                padding: 10px 8px;
                font-size: 14px;
            }

            /* Adjust column widths for mobile */
            .songlist-table th:nth-child(1),
            .songlist-table td:nth-child(1) {
                width: 35%;
            }

            .songlist-table th:nth-child(2),
            .songlist-table td:nth-child(2) {
                width: 40%;
            }

            .songlist-table th:nth-child(3),
            .songlist-table td:nth-child(3) {
                width: 25%;
            }

            .request-btn {
                padding: 6px 14px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Patrick Boylan's Song List</h1>

    <!-- Filter Buttons -->
    <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All Songs</button>
        <button class="filter-btn" data-filter="Musicals">Musicals</button>
        <button class="filter-btn" data-filter="Classic Piano Bar Tunes">Classic Piano Bar Tunes</button>
        <button class="filter-btn" data-filter="Disney">Disney</button>
        <button class="filter-btn" data-filter="2000-Present">2000-Present</button>
        <button class="filter-btn" data-filter="90's">90's</button>
        <button class="filter-btn" data-filter="60's-80's">60's-80's</button>
        <button class="filter-btn" data-filter="Jazz">Jazz</button>
        <button class="filter-btn" data-filter="Holiday">Holiday</button>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Search for song">
    </div>

    <!-- Error Message -->
    <div class="error-message" id="errorMessage">
        <p id="errorText">Oops! Looks like Pat doesn't know "<span id="searchTerm"></span>"</p>
        <button class="notify-btn" id="notifyBtn">Click to tell him to learn it!</button>
    </div>

    <!-- Song Table -->
    <div class="songlist-wrapper">
        <table class="songlist-table" id="songTable">
            <thead>
                <tr>
                    <th>Song Title</th>
                    <th>Artist / Show</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="songBody">
                <!-- Songs will be loaded here via JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        let allSongs = [];
        let currentFilter = 'all';
        let currentSearchTerm = '';

        // Levenshtein Distance - measures similarity between two strings
        function levenshteinDistance(str1, str2) {
            const len1 = str1.length;
            const len2 = str2.length;
            const matrix = [];

            for (let i = 0; i <= len1; i++) {
                matrix[i] = [i];
            }

            for (let j = 0; j <= len2; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    if (str1.charAt(i - 1) === str2.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }

            return matrix[len1][len2];
        }

        // Fuzzy search with incredible leniency
        function fuzzySearch(searchTerm, songs) {
            if (!searchTerm || searchTerm.trim() === '') {
                return songs;
            }

            const term = searchTerm.toLowerCase().trim();
            const results = [];

            songs.forEach(song => {
                const title = song.title.toLowerCase();
                const artist = song.artist.toLowerCase();
                
                // Calculate similarity scores
                let bestScore = Infinity;
                let matchType = '';

                // Exact substring match (highest priority)
                if (title.includes(term) || artist.includes(term)) {
                    bestScore = 0;
                    matchType = 'exact';
                }
                // Partial word match
                else {
                    const titleWords = title.split(/\s+/);
                    const artistWords = artist.split(/\s+/);
                    const searchWords = term.split(/\s+/);

                    searchWords.forEach(searchWord => {
                        // Check title words
                        titleWords.forEach(titleWord => {
                            if (titleWord.includes(searchWord) || searchWord.includes(titleWord)) {
                                bestScore = Math.min(bestScore, 1);
                                matchType = 'partial';
                            } else {
                                const distance = levenshteinDistance(searchWord, titleWord);
                                const maxLen = Math.max(searchWord.length, titleWord.length);
                                const similarity = 1 - (distance / maxLen);
                                
                                // Stricter threshold - 30% similarity
                                if (similarity >= 0.3) {
                                    bestScore = Math.min(bestScore, distance);
                                    matchType = 'fuzzy';
                                }
                            }
                        });

                        // Check artist words
                        artistWords.forEach(artistWord => {
                            if (artistWord.includes(searchWord) || searchWord.includes(artistWord)) {
                                bestScore = Math.min(bestScore, 1);
                                matchType = 'partial';
                            } else {
                                const distance = levenshteinDistance(searchWord, artistWord);
                                const maxLen = Math.max(searchWord.length, artistWord.length);
                                const similarity = 1 - (distance / maxLen);
                                
                                if (similarity >= 0.3) {
                                    bestScore = Math.min(bestScore, distance);
                                    matchType = 'fuzzy';
                                }
                            }
                        });
                    });
                }

                // If we found a match, add to results
                if (bestScore < Infinity) {
                    results.push({
                        song: song,
                        score: bestScore,
                        matchType: matchType
                    });
                }
            });

            // Sort by score (lower is better)
            results.sort((a, b) => {
                if (a.matchType === 'exact' && b.matchType !== 'exact') return -1;
                if (a.matchType !== 'exact' && b.matchType === 'exact') return 1;
                return a.score - b.score;
            });

            return results.map(r => r.song);
        }

        // Load songs from JSON
        async function loadSongs() {
            try {
                const response = await fetch('songs.json');
                allSongs = await response.json();
                renderSongs();
            } catch (error) {
                console.error('Error loading songs:', error);
                document.getElementById('songBody').innerHTML = 
                    '<tr><td colspan="3" style="text-align: center; padding: 20px;">Error loading songs. Please try again later.</td></tr>';
            }
        }

        // Render songs based on current filter and search
        function renderSongs() {
            const tbody = document.getElementById('songBody');
            const errorMessage = document.getElementById('errorMessage');
            tbody.innerHTML = '';

            // Filter by category first
            let filteredSongs = allSongs;
            if (currentFilter !== 'all') {
                filteredSongs = allSongs.filter(song => 
                    song.tags && song.tags.includes(currentFilter)
                );
            }

            // Apply search if there's a search term
            if (currentSearchTerm) {
                filteredSongs = fuzzySearch(currentSearchTerm, filteredSongs);
            }

            // Show error if no results
            if (currentSearchTerm && filteredSongs.length === 0) {
                errorMessage.classList.add('show');
                document.getElementById('searchTerm').textContent = currentSearchTerm;
            } else {
                errorMessage.classList.remove('show');
            }

            // Sort alphabetically by title
            filteredSongs.sort((a, b) => 
                a.title.toLowerCase().localeCompare(b.title.toLowerCase())
            );

            // Render songs
            filteredSongs.forEach(song => {
                const row = document.createElement('tr');
                
                const titleCell = document.createElement('td');
                titleCell.textContent = song.title;
                
                const artistCell = document.createElement('td');
                artistCell.textContent = song.artist;
                
                const requestCell = document.createElement('td');
                const requestLink = document.createElement('a');
                requestLink.href = `venmo://paycharge?txn=pay&recipients=patrickTSG&amount=5&note=Song Request: ${encodeURIComponent(song.title + ' - ' + song.artist)}`;
                requestLink.className = 'request-btn';
                requestLink.textContent = 'Request';
                requestCell.appendChild(requestLink);
                
                row.appendChild(titleCell);
                row.appendChild(artistCell);
                row.appendChild(requestCell);
                
                tbody.appendChild(row);
            });
        }

        // Live search - filter as user types
        document.getElementById('searchInput').addEventListener('input', function() {
            currentSearchTerm = this.value;
            renderSongs();
        });

        // Filter button click handlers
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Update active state
                document.querySelectorAll('.filter-btn').forEach(btn => 
                    btn.classList.remove('active')
                );
                this.classList.add('active');

                // Update filter and re-render
                currentFilter = this.getAttribute('data-filter');
                renderSongs();
            });
        });

        // Notify button - PLACEHOLDER FOR EMAILJS
        document.getElementById('notifyBtn').addEventListener('click', function() {
            const searchTerm = document.getElementById('searchTerm').textContent;
            
            // TODO: Replace this with EmailJS integration
            // For now, show alert
            alert('EmailJS will send: "Someone requested "' + searchTerm + '" at TSG and you don\'t know it! Shame! Learn it!" to pdboyla1@gmail.com');
            
            // EMAILJS CODE WILL GO HERE:
            // emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
            //     song_request: searchTerm,
            //     to_email: 'pdboyla1@gmail.com'
            // });
        });

        // Load songs on page load
        loadSongs();
    </script>
</body>
</html>
